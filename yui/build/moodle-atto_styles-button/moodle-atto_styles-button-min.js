YUI.add("moodle-atto_styles-button",function(i,e){i.namespace("M.atto_styles").Button=i.Base.create("button",i.M.editor_atto.EditorPlugin,[],{initializer:function(){var t,n,o,s,e=this.get("styles");e=JSON.parse(e),t=[],i.Array.each(e,function(e){n="<i></i>",o="<span>","nostyle"===e.type?(n='<i class="nostyleelement"></i>',o='<span class="nostyle">'):"block"===e.type?(n='<i class="blockelement"></i>',o='<span class="blockstyle">'):"inline"==e.type&&(n='<i class="inlineelement"></i>',o='<span class="inlinestyle">'),t.push({text:o+n+e.title+"</span>",callbackArgs:["<"+e.type+">",e.classes]})}),s=this._showToolbarMenu,this._showToolbarMenu=function(e,t){var n,o;s.call(this,e,t),n=this.hasRangeSelected(),o=this.menus[t.buttonClass].get("contentBox"),n?o.removeClass("disableinline"):o.addClass("disableinline"),this.toolbar.after("click",i.bind(this._setDropdownHeight,this)),i.on("windowresize",i.bind(this._setDropdownHeight,this))},this.addToolbarMenu({icon:"icon",iconComponent:"atto_styles",buttonClass:"styles",globalItemConfig:{callback:this._changeStyle},items:t})},_changeStyle:function(e,t){var n,o,s,i,l,a,r;if("<nostyle>"!==t[0]){if("<block>"===t[0]){if(document.execCommand("formatBlock",!1,"<div>"),o=window.getSelection().focusNode,!this.editor.contains(o))return;for(s=o;s;s=s.parentNode)if(1===s.nodeType&&(i=window.getComputedStyle(s,null))&&"block"===i.getPropertyValue("display")){n=s;break}n.setAttribute("class",t[1])}else for(l=t[1].split(" "),a=this.get("host"),r=0;r<l.length;r+=1)a.toggleInlineSelectionClass([l[r]]);this.markUpdated()}else{if(o=window.getSelection().focusNode,!this.editor.contains(o))return;for(s=o;s;s=s.parentNode)if(1===s.nodeType&&(i=window.getComputedStyle(s,null))){s.removeAttribute("class");break}}},hasRangeSelected:function(){var e;return!!(e=rangy.getSelection()).rangeCount&&!e.getRangeAt(0).collapsed},_setDropdownHeight:function(){var e=parseInt(this.editor._node.clientHeight,10)+35;i.one(".editor_atto_menu .atto_styles_button .dropdown-menu").setStyle("max-height",e)}},{ATTRS:{styles:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});