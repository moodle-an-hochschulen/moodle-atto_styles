YUI.add("moodle-atto_styles-button",function(l,t){l.namespace("M.atto_styles").Button=l.Base.create("button",l.M.editor_atto.EditorPlugin,[],{initializer:function(){var e,s,i,n,o,t=this.get("styles"),t=JSON.parse(t),a=[];l.Array.each(t,function(t){e="<i></i>",s="<span>",i='<span class="title">',n="","nostyle"===t.type?(e='<i class="fa fa-fw fa-times"></i>',s='<span class="nostyle">'):"block"===t.type?(e='<i class="fa fa-fw fa-tint"></i>',s='<span class="blockstyle">'):"inline"==t.type&&(e='<i class="fa fa-fw fa-i-cursor"></i>',s='<span class="inlinestyle">',n='<br /><span class="inlinehint tag tag-info">'+M.util.get_string("inlinehint","atto_styles")+"</span>"),!0===t.preview&&(i='<span class="preview '+t.classes+'">'),a.push({text:s+e+i+t.title+"</span>"+n+"</span>",callbackArgs:["<"+t.type+">",t.classes]})}),o=this._showToolbarMenu,this._showToolbarMenu=function(t,e){o.call(this,t,e),t=this.hasRangeSelected(),e=this.menus[e.buttonClass].get("contentBox"),t?e.removeClass("disableinline"):e.addClass("disableinline"),this.toolbar.after("click",l.bind(this._setDropdownHeight,this)),l.on("windowresize",l.bind(this._setDropdownHeight,this))},this.addToolbarMenu({icon:"icon",iconComponent:"atto_styles",buttonClass:"styles",globalItemConfig:{callback:this._changeStyle},items:a})},_changeStyle:function(t,e){var s,i,n,o,a,l,r;if("<nostyle>"!==e[0]){if("<block>"===e[0]){if(document.execCommand("formatBlock",!1,"<div>"),i=window.getSelection().focusNode,!this.editor.contains(i))return;for(n=i;n;n=n.parentNode)if(1===n.nodeType&&(o=window.getComputedStyle(n,null))&&"block"===o.getPropertyValue("display")){s=n;break}s.setAttribute("class",e[1])}else for(a=e[1].split(" "),l=this.get("host"),r=0;r<a.length;r+=1)l.toggleInlineSelectionClass([a[r]]);this.markUpdated()}else if(i=window.getSelection().focusNode,this.editor.contains(i))for(n=i;n;n=n.parentNode)if(1===n.nodeType&&n.getAttribute("class")){if(-1!=n.getAttribute("class").search("editor_atto_content"))break;if(o=window.getComputedStyle(n,null)){n.removeAttribute("class");break}}},hasRangeSelected:function(){var t=window.rangy.getSelection();return!!t.rangeCount&&!t.getRangeAt(0).collapsed},_setDropdownHeight:function(){var t=parseInt(this.editor._node.clientHeight,10)+35;l.one(".editor_atto_menu .atto_styles_button .dropdown-menu").setStyle("max-height",t)}},{ATTRS:{styles:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});